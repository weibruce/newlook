(function(a){a.fn.newlookOpening=function(f){function n(a){var d=new Date(a);a=d.getFullYear()+"\u5e74";var A=d.getMonth()+1+"\u6708",d=d.getDate()+"\u65e5";return[a,A,d].join("")}function k(){a("#refreshBtn").on("click",function(){window.location.href=b+x});a("#errorModal").addClass("show")}function r(){a(".container-modal .modal-close").on("click",function(){a("#prizeModal").removeClass("show");a("#thanksModal").removeClass("show");a("#errorModal").removeClass("show");a("#shareModal").removeClass("show");
g=!1});a(".container-modal .modal-share-btn").on("click",function(){a("#shareModal").addClass("show");g=!0});a(".container-modal .modal-share-close").on("click",function(){a("#shareModal").removeClass("show");g=!1});a("#shakeBtn").on("click",function(){g||p()});a("#bagBtn").on("click",function(){window.location.href="mybag.html"});a("#ruleBtn").on("click",function(){a("#ruleModal").addClass("show");g=!0});a(".container-modal-rule .rule-close").on("click",function(){a("#ruleModal").removeClass("show");
g=!1})}function q(){var a=(new Date).getTime(),a=JSON.stringify({uid:c,sharedOccurTime:a,event:{openingCode:e}});l(a)}function p(){g=!0;var a=(new Date).getTime(),a=JSON.stringify({uid:c,occurTime:a,event:{openingCode:e}});m(a)}function t(a){a=a.accelerationIncludingGravity;var d=(new Date).getTime();if(100<d-u){var b=d-u;u=d;v=a.x;y=a.y;z=a.z;a=Math.abs(v+y+z-last_x-last_y-last_z)/b*1E4;g||1E3<a&&p();last_x=v;last_y=y;last_z=z}}function w(b){a.get(h+"/service/wechat/jsconfig?url="+window.location.href,
b,function(a){a.success&&a.data&&(a=a.data,wx.config({debug:!1,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}))})}function m(b){a.ajax({type:"POST",url:h+"/service/coupons/draw",data:b,contentType:"application/json; charset=utf-8",dataType:"json",success:function(d){d=d.data;g=!0;d?9==d.coupon.oid?(a("#thanksTitle").text("\u60a8\u6ca1\u6709\u4e2d\u5956"),a("#thanksModal").addClass("show"),g=!0):(a("#prizeModal").addClass("show"),
g=!0,a("#prizeName").text(d.coupon.name+"\uff01"),a("#prizeImg").removeClass("prize-img1 prize-img2 prize-img3 prize-img4"),a("#prizeImg").addClass("prize-img"+d.coupon.oid),3==d.coupon.oid||4==d.coupon.oid?a("#prizeDesc").html("\u4ee3\u91d1\u5238\u5df2\u653e\u5165\u6211\u7684\u793c\u888b\uff0c\u8bf7\u4e8e\u7ed3\u8d26\u65f6\u4f7f\u7528<br>\u4f7f\u7528\u89c4\u5219\u8bf7\u67e5\u770b\u6d3b\u52a8\u7ec6\u5219"):a("#prizeDesc").html("\u5956\u5238\u5df2\u653e\u5165\u6211\u7684\u793c\u888b\uff0c\u8bf7\u51ed\u5238\u5230\u5e97\u5185\u9886\u53d6")):
(a("#expireModal").addClass("show"),g=!0);B++},error:function(d){g=!1;a("#thanksTitle").text("\u4eca\u5929\u7684\u6447\u5956\u6b21\u6570\u5df2\u7528\u5b8c");a("#thanksModal").addClass("show")}})}function l(b){a.ajax({type:"POST",url:h+"/service/shared-events/share",data:b,contentType:"application/json; charset=utf-8",dataType:"json",success:function(d){a("#prizeModal").removeClass("show");a("#thanksModal").removeClass("show");a("#shareModal").removeClass("show");a("#errorModal").removeClass("show");
g=!1},error:function(a){a=a.responseJSON.error;if(a.errorCode)switch(a.errorCode){case "0x010203003":alert("\u5956\u5238\u5df2\u5931\u6548\u6216\u5151\u5956\u65f6\u95f4\u5df2\u8fc7");break;case "0x010203006":alert("\u4eca\u5929\u7684\u6447\u5956\u6b21\u6570\u5df2\u7528\u5b8c")}}})}f=a.extend({http:"http://",host:"",port:"",path:"/",project:"",openingCode:""},f);var e=f.openingCode,h=f.http+f.host+("/"==f.path?"":f.path)+f.project,b=h+"/service/wechat/from?state=",c,x,B=0,g=!1,u=0,v=y=z=last_x=last_y=
last_z=0;wx.ready(function(){wx.onMenuShareAppMessage({title:"New Look\u5f00\u4e1a\u6709\u5956\uff0c\u5feb\u6765\u62ff\u8d70\u4f60\u7684\u4e13\u5c5e\u5927\u5956",desc:"9\u670823-25\u65e5NEW LOOK\u4e0a\u6d77\u6c5f\u6865\u4e07\u8fbe\u5e97\u65b0\u5e97\u5f00\u4e1a\uff0c\u5feb\u6765\u5e97\u5185\u770b\u770b\uff0c\u53e6\u6709\u60ca\u559c\u7b49\u7740\u60a8\uff01",link:"http://www.5hac.com/querer/service/wechat/from?state=share",imgUrl:"http://www.5hac.com/src/images/newlook_share_img1.jpg",type:"",dataUrl:"",
success:function(){q()},cancel:function(){}});wx.onMenuShareTimeline({title:"New Look\u5f00\u4e1a\u6709\u5956\uff0c\u5feb\u6765\u62ff\u8d70\u4f60\u7684\u4e13\u5c5e\u5927\u5956",link:"http://www.5hac.com/querer/service/wechat/from?state=share",imgUrl:"http://www.5hac.com/src/images/newlook_share_img1.jpg",success:function(){q()},cancel:function(){}})});x=function(a){a=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");a=window.location.search.substr(1).match(a);return null!=a?decodeURI(a[2]):null}("state");
(function(b){a.get(h+"/service/events/"+e,b,function(b){if(!b.success)k();else if(b.data){b=b.data;c=b.openId;sessionStorage.setItem("openid",b.openId);c?(w(),r(),window.DeviceOrientationEvent?window.addEventListener("devicemotion",t):alert("Sorry your browser doesn't support Device Orientation")):k();n(b.startTime);n(b.endTime);var d=(new Date).getTime();d<b.startTime?(a("#expireModal").addClass("show"),a("#expireTitle").text("\u6d3b\u52a8\u5c1a\u672a\u5f00\u59cb")):d>b.endTime&&(a("#expireModal").addClass("show"),
a("#expireTitle").text("\u6d3b\u52a8\u5df2\u7ed3\u675f"))}})})()};a.fn.newlookMybag=function(f){function n(e){a(".bag-modal .modal-close").on("click",function(){a("#bagModal").removeClass("show")});a("#shakeModal .modal-close").on("click",function(){window.history.go(-1);a("#shakeModal").removeClass("show")});a(".bag-modal .modal-close2").on("click",function(){a("#confirmCover").removeClass("show")});a("#confirmBtn").on("click",function(){a("#confirmCover").addClass("show")});a("#destroyBtn").on("click",
function(){var b=a(this).attr("data-id"),c=(new Date).getTime(),b=JSON.stringify({oid:b,uid:l,usedOccurTime:c});t(b)})}function k(){a("#bagLoading").addClass("show");a("#shakeModal").removeClass("show");a("#bagList").removeClass("show");e=null;p()}function r(h){a("#bagLoading").removeClass("show");if(0>=h.length)a("#shakeModal").addClass("show");else{e=h;a("#bagList").empty();h="";for(var b=0;b<e.length;b++)if(9!=e[b].coupon.oid){var c="",f=3==e[b].coupon.oid||4==e[b].coupon.oid?"coupon":"gift",k=
e[b].used?"icon-disable":"",g=e[b].used?"show":"",l=e[b].used?"\u5df2\u9886\u53d6":"\u70b9\u51fb\u67e5\u770b",c=c+('<div id="item'+e[b].oid+'" class="container-baglist-item">'),c=c+('<div class="item-icon"><div class="icon-left icon-'+f+" "+k+'"></div></div>'),c=c+('<div class="item-box"><div class="item-disalbe-cover '+g+'"></div><div class="item-content">'),c=c+('<div class="item-title">'+e[b].coupon.name+"</div>"),c=c+('<div class="item-img prize-img'+e[b].coupon.oid+'"></div>'),c=c+('<div class="item-btn">'+
l+"</div>"),c=c+"</div></div></div>";h+=c}""==h?a("#shakeModal").addClass("show"):(a("#bagList").addClass("show"),a("#bagList").html(h));a(".container-baglist-item .item-btn").on("click",function(){a("#bagModal").addClass("show");var b=a(this).parent().parent().parent().attr("id").substring(4);if(b){for(var c,d=0;d<e.length;d++)e[d].oid==b&&(c=e[d]);a("#bagName").text(c.coupon.name+"\uff01");a("#bagImg").removeClass("prize-img1 prize-img2 prize-img3 prize-img4");a("#bagImg").addClass("prize-img"+
c.coupon.oid);a("#destroyBtn").attr("data-id",b);3==c.coupon.oid||4==c.coupon.oid?(a("#bagDesc").html("\u8bf7\u4e8e\u7ed3\u8d26\u65f6\u5230\u6536\u94f6\u53f0\u51fa\u793a\u4f7f\u7528<br />\u4f7f\u7528\u89c4\u5219\u8bf7\u53c2\u89c1\u6d3b\u52a8\u7ec6\u5219"),JsBarcode("#code128",c.barcode,{format:"code128",height:40}),a(".modal-desc").height(15),a(".modal-barcode").css({"margin-top":"-25px"}),a(".modal-barcode").addClass("show"),a("#barcodeSvg").addClass("show")):(a("#bagDesc").html("\u8bf7\u51ed\u6b64\u5238\u5230\u5e97\u5185\u9886\u53d6<br />\u9886\u5956\u89c4\u5219\u8bf7\u89c1\u6d3b\u52a8\u7ec6\u5219"),
a(".modal-desc").height(60),a(".modal-barcode").css({"margin-top":"0px"}),a("#barcodeSvg").removeClass("show"))}})}}function q(e){a.get(m+"/service/wechat/jsconfig?url="+window.location.href,e,function(a){a.success&&a.data&&(a=a.data,wx.config({debug:!1,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}))})}function p(e){a.get(m+"/service/coupons/"+w+"?uid="+l,e,function(a){a.success&&r(a.data)})}function t(e){a.ajax({type:"PUT",
url:m+"/service/coupons/use",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(b){a("#bagModal").removeClass("show");a("#confirmCover").removeClass("show");k()},error:function(a){}})}f=a.extend({http:"http://",host:"",port:"",path:"/",project:"",openingCode:""},f);var w=f.openingCode,m=f.http+f.host+("/"==f.path?"":f.path)+f.project,l,e;wx.ready(function(){wx.onMenuShareAppMessage({title:"New Look\u5f00\u4e1a\u6709\u5956\uff0c\u5feb\u6765\u62ff\u8d70\u4f60\u7684\u4e13\u5c5e\u5927\u5956",
desc:"9\u670823-25\u65e5NEW LOOK\u4e0a\u6d77\u6c5f\u6865\u4e07\u8fbe\u5e97\u65b0\u5e97\u5f00\u4e1a\uff0c\u5feb\u6765\u5e97\u5185\u770b\u770b\uff0c\u53e6\u6709\u60ca\u559c\u7b49\u7740\u60a8\uff01",link:"http://www.5hac.com/querer/service/wechat/from?state=share",imgUrl:"http://www.5hac.com/src/images/newlook_share_img1.jpg",type:"",dataUrl:"",success:function(){callShareFun()},cancel:function(){}});wx.onMenuShareTimeline({title:"New Look\u5f00\u4e1a\u6709\u5956\uff0c\u5feb\u6765\u62ff\u8d70\u4f60\u7684\u4e13\u5c5e\u5927\u5956",
link:"http://www.5hac.com/querer/service/wechat/from?state=share",imgUrl:"http://www.5hac.com/src/images/newlook_share_img1.jpg",success:function(){callShareFun()},cancel:function(){}})});(l=sessionStorage.getItem("openid"))?(q(),n(),k()):(a("#bagLoading").removeClass("show"),a("#shakeModal").addClass("show"))}})(jQuery);